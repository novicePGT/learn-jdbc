# 트랜잭션 - DB 예제1( 개념 이해 )
트랜잭션의 구체적인 실제 구현 방식은 데이터베이스 마다 다르다.   

## 트랜잭션 사용법
- 데이터 변경 쿼리를 실행하고 데이터베이스에 그 결과를 반영하려면 커밋 명령어인 commit 을 호출하고, 반영하고 싶지 않으면 롤백 명령어인 rollback 을 호출하면 된다.   
- 커밋을 호출하기 전까지는 임시로 데이터를 저장하는 것이다. 따라서 해당 트랜잭션을 시작한 세션( 사용자 )에게만 변경 데이터가 보이고 다른 세션( 사용자 )에게는 변경 데이터가 보이지 않는다.
- 등록, 수정, 삭제 모두 같은 원리로 동작한다.

## 신규 데이터가 추가된 경우
<img width="567" alt="스크린샷 2023-06-13 오후 3 35 21" src="https://github.com/novicePGT/learn-jdbc/assets/91667488/52574e0d-1df3-4b78-b5cb-01f5741f8d0e">   
- 세션 1은 트랜잭션을 시작하고 신규 회원1, 신규 회원2 를 DB에 추가했다. 하지만 commit 하지 않은 상태이다.
- commit 하지 않았으니, 새로운 데이터는 임시 상태로 저장된다.
- 세션1 은 select 쿼리를 실행해서 본인이 입력한 신규 회원 1, 신규 회원 2를 조회할 수 있다.
- 세션2 는 select 쿼리를 실행해도 신규 회원들을 조회할 수 없다.
- 세션1 이 아직 커밋을 하지 않은 상태이기 때문에 조회할 수 없는것이다.

#### 커밋하지 않은 데이터를 다른 곳에서 조회할 수 있으면 어떤 문제가 발생하는지?
- 커밋하지 않은 데이터가 보이면, 세션2 는 데이터를 조회했을 때 신규 회원 1,2 가 보일 것이다.
- 따라서 신규 회원 1, 신규 회원 2 가 있다는 가정하에 로직을 수행할 수 있을 것이다.
- 그런데 세션 1에서 rollback 을 수행한다면 신규 회원 1,2 의 데이터가 사라지게 된다.
- 세션 2에서 세션 1이 아직 커밋하지 않은 변경 데이터가 보인다면, 세션 1이 롤백 했을 때 심각한 문제가 발생할 수 있다. 따라서 커밋 전의 데이터는 다른 세션에서 보이지 않는다.   

## 신규 데이터 추가 후 commit
<img width="559" alt="스크린샷 2023-06-13 오후 3 41 18" src="https://github.com/novicePGT/learn-jdbc/assets/91667488/1a28d19c-b2cb-4b28-8a73-33c4460b41a2">  
- 세션 1이 신규 뎅터를 추가한 후에 commit 을 호출했다.
- commit 으로 새로운 데이터가 실제 데이터베이스에 반영된다.
- 데이터의 상태도 임시 -> 완료 로 변경된다.
- 다른 세션에서도 회원 테이블을 조회하면 신규 회원들을 확인할 수 있다.

## 신규 데이터 추가 후 rollback
<img width="564" alt="스크린샷 2023-06-13 오후 3 42 43" src="https://github.com/novicePGT/learn-jdbc/assets/91667488/b5c1f1a9-3e7e-45f4-b0bb-cd89e2e2bd8e">   
- 세션 1이 신규 데이터를 추가한 후에 commit 대신 rollback 을 호출했다.
- 세션 1이 데이터베이스에 반영한 모든 데이터가 처음 상태로 복구된다.
- 수정하거나 삭제한 데이터도 rollback 을 호출하면 모두 트랜잭션을 시작하기 직전의 상태로 복구된다.
